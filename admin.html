<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HYPE NET â€” Store Admin</title>
  
  <link rel="icon" href="https://i.postimg.cc/fLSj38WK/hype-net512.jpg" type="image/jpeg">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
    body{font-family:'Tajawal',sans-serif;background:#f3f4f6;}
    #login-overlay {position: fixed; inset: 0; background: #111827; z-index: 9999; color: white;}
    .section-title { border-bottom: 2px solid #e5e7eb; padding-bottom: 10px; margin-bottom: 20px; color: #374151; font-weight: bold; font-size: 1.25rem; }
    .loader { border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #16a34a; width: 24px; height: 24px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>

  <script>
    window.__app_id = "hype-net-display-page";
    window.__firebase_config = JSON.stringify({"apiKey": "AIzaSyBaDcnOmMeZaoJT6wLRlezFsveJL7aAtdc", "authDomain": "hype-net-display-page.firebaseapp.com", "projectId": "hype-net-display-page", "storageBucket": "hype-net-display-page.firebasestorage.app", "messagingSenderId": "505174394261", "appId": "1:505174394261:web:92fe3ffec55c8a2ad0a29c", "measurementId": "G-M7YWJKGP62"});
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    const config = JSON.parse(__firebase_config);
    const app = initializeApp(config);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const appId = "hype-net-display-page";

    onAuthStateChanged(auth, (user) => {
        const overlay = document.getElementById('login-overlay');
        const content = document.getElementById('admin-content');
        if (user) {
            overlay.style.display = 'none';
            content.classList.remove('hidden');
            document.getElementById('current-user-email').innerText = user.email;
            loadData();
        } else {
            overlay.style.display = 'flex';
            overlay.classList.remove('hidden');
            content.classList.add('hidden');
        }
    });

    function loadData() {
        loadLinks();
        loadStoreProducts(); // ØªÙ… ØªØºÙŠÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ù…ØªØ¬Ø±
        loadPortfolio();
    }

    window.performLogin = async function() {
      const email = document.getElementById('admin-email').value;
      const pass = document.getElementById('admin-password').value;
      const btn = document.getElementById('login-btn');
      const err = document.getElementById('login-error');

      if(!email || !pass) { err.innerText = "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©"; return; }

      try {
          btn.innerHTML = '<div class="loader mx-auto"></div>';
          await signInWithEmailAndPassword(auth, email, pass);
      } catch (error) {
          btn.innerText = "Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù†";
          if(error.code === 'auth/invalid-credential' || error.code === 'auth/wrong-password') {
              err.innerText = "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
          } else {
              err.innerText = "Ø®Ø·Ø£: " + error.message;
          }
      }
    }

    window.performLogout = function() { signOut(auth).then(() => window.location.reload()); }

    const sanitizeUrl = (url) => {
        if (!url) return '';
        let cleanUrl = url.trim();
        if (cleanUrl && !cleanUrl.startsWith('http://') && !cleanUrl.startsWith('https://')) {
            cleanUrl = 'https://' + cleanUrl;
        }
        return cleanUrl;
    };

    // 1. Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¹Ø§Ù…Ø©
    async function addLink(){
      const title = document.getElementById('link-title').value.trim();
      const url = sanitizeUrl(document.getElementById('link-url').value);
      if(!title || !url) return alert('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©');
      await addDoc(collection(db, `artifacts/${appId}/public/data/links`), { title, url, timestamp: serverTimestamp() });
      document.getElementById('link-title').value=''; document.getElementById('link-url').value='';
    }
    function loadLinks(){
        onSnapshot(query(collection(db, `artifacts/${appId}/public/data/links`), orderBy('timestamp','desc')), (snap)=>{
            const box = document.getElementById('links-container'); box.innerHTML='';
            snap.forEach(d => createItemElement(d, box, 'links'));
        });
    }

    // 2. Ø§Ù„Ù…ØªØ¬Ø± (Store Products) - Ø§Ù„Ù…Ø¹Ø¯Ù„
    async function addStoreProduct(){
      const title = document.getElementById('prod-title').value.trim();
      const price = document.getElementById('prod-price').value.trim();
      const url = sanitizeUrl(document.getElementById('prod-url').value); // Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙØ¹
      const img = sanitizeUrl(document.getElementById('prod-img').value); // Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©

      if(!title || !price || !url || !img) return alert('Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ØªØ¬Ø± Ù…Ø·Ù„ÙˆØ¨Ø© (Ø§Ù„Ø³Ø¹Ø±ØŒ Ø§Ù„ØµÙˆØ±Ø©ØŒ Ø§Ù„Ø±Ø§Ø¨Ø·)');
      
      await addDoc(collection(db, `artifacts/${appId}/public/data/store_products`), { 
          title, price, url, img, timestamp: serverTimestamp() 
      });
      
      document.getElementById('prod-title').value=''; 
      document.getElementById('prod-price').value='';
      document.getElementById('prod-url').value='';
      document.getElementById('prod-img').value='';
    }

    function loadStoreProducts(){
        onSnapshot(query(collection(db, `artifacts/${appId}/public/data/store_products`), orderBy('timestamp','desc')), (snap)=>{
            const box = document.getElementById('store-container'); box.innerHTML='';
            snap.forEach(d => {
                const item = d.data();
                const el = document.createElement('div');
                el.className = 'bg-white p-3 rounded shadow flex items-center gap-3 border border-gray-200 mb-2';
                el.innerHTML = `
                    <img src="${item.img}" class="w-12 h-12 object-cover rounded bg-gray-100">
                    <div class="flex-1">
                        <div class="font-bold text-sm">${item.title}</div>
                        <div class="text-green-600 font-bold text-xs">$${item.price}</div>
                    </div>
                    <button class="text-red-500 font-bold px-2" onclick="deleteItem('store_products', '${d.id}')">X</button>
                `;
                box.appendChild(el);
            });
        });
    }

    // 3. Ø§Ù„Ù…Ø¹Ø±Ø¶ (Portfolio)
    async function addPortfolio(){
      const title = document.getElementById('port-title').value.trim();
      const url = sanitizeUrl(document.getElementById('port-url').value);
      const img = sanitizeUrl(document.getElementById('port-img').value);
      const platform = document.getElementById('port-platform').value;

      if(!title || !url || !img) return alert('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©');
      await addDoc(collection(db, `artifacts/${appId}/public/data/portfolio`), { title, url, img, platform, timestamp: serverTimestamp() });
      document.getElementById('port-title').value=''; document.getElementById('port-url').value=''; document.getElementById('port-img').value='';
    }
    function loadPortfolio(){
        onSnapshot(query(collection(db, `artifacts/${appId}/public/data/portfolio`), orderBy('timestamp','desc')), (snap)=>{
            const box = document.getElementById('portfolio-container'); box.innerHTML='';
            snap.forEach(d => {
                const item = d.data();
                const el = document.createElement('div');
                el.className = 'bg-white p-3 rounded shadow flex items-center gap-3 border border-gray-200 mb-2';
                el.innerHTML = `
                    <img src="${item.img}" class="w-12 h-12 object-cover rounded bg-gray-100">
                    <div class="flex-1">
                        <div class="font-bold text-sm">${item.title}</div>
                        <div class="text-[10px] text-gray-500">${item.platform}</div>
                    </div>
                    <button class="text-red-500 font-bold px-2" onclick="deleteItem('portfolio', '${d.id}')">X</button>
                `;
                box.appendChild(el);
            });
        });
    }

    function createItemElement(docData, container, colName) {
        const item = docData.data();
        const el = document.createElement('div');
        el.className = 'bg-gray-50 p-2 rounded flex justify-between items-center mb-2 border';
        el.innerHTML = `<span class="font-bold text-sm truncate w-2/3">${item.title}</span> <button class="text-red-500 font-bold" onclick="deleteItem('${colName}', '${docData.id}')">X</button>`;
        container.appendChild(el);
    }

    window.addLink = addLink;
    window.addStoreProduct = addStoreProduct;
    window.addPortfolio = addPortfolio;
    window.deleteItem = async (col, id) => { if(confirm('Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ±ØŸ')) await deleteDoc(doc(db, `artifacts/${appId}/public/data/${col}`, id)); };
  </script>
</head>
<body class="bg-gray-100 pb-20">

  <div id="login-overlay" class="flex flex-col items-center justify-center">
    <div class="w-full max-w-md p-8 bg-gray-900 rounded-2xl shadow-2xl border border-gray-700 mx-4 relative">
      <div class="text-center mb-8">
          <img src="https://i.postimg.cc/fLSj38WK/hype-net512.jpg" class="w-20 h-20 rounded-full mx-auto mb-4 border-2 border-green-500">
          <h2 class="text-3xl font-bold text-white">Store Manager</h2>
      </div>
      <div class="space-y-4">
          <input type="email" id="admin-email" placeholder="Email" class="w-full p-3 rounded bg-gray-800 border border-gray-700 text-white text-center">
          <input type="password" id="admin-password" placeholder="Password" class="w-full p-3 rounded bg-gray-800 border border-gray-700 text-white text-center">
          <div id="login-error" class="text-red-500 text-sm text-center font-bold"></div>
          <button id="login-btn" onclick="performLogin()" class="w-full bg-green-600 hover:bg-green-700 text-white p-3 rounded font-bold">Ø¯Ø®ÙˆÙ„</button>
      </div>
    </div>
  </div>

  <div id="admin-content" class="max-w-5xl mx-auto p-4 hidden">
    <div class="flex justify-between items-center mt-4 mb-8">
        <h1 class="text-3xl font-black text-gray-800">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
        <div class="flex items-center gap-3">
            <span id="current-user-email" class="text-xs text-gray-500 bg-white px-3 py-1 rounded-full border"></span>
            <button onclick="performLogout()" class="bg-red-50 text-red-600 px-4 py-2 rounded text-sm font-bold hover:bg-red-100">Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        
        <!-- 1. Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¹Ø§Ù…Ø© -->
        <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-gray-600">
            <h2 class="section-title">1. Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¹Ø§Ù…Ø© (Links)</h2>
            <div class="space-y-3 mb-4">
                <input id="link-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø§Ø¨Ø·" class="w-full p-2 border rounded">
                <input id="link-url" placeholder="URL" class="w-full p-2 border rounded">
                <button onclick="addLink()" class="w-full bg-gray-700 text-white p-2 rounded hover:bg-gray-800">Ø£Ø¶Ù Ø±Ø§Ø¨Ø·</button>
            </div>
            <div id="links-container" class="max-h-[250px] overflow-y-auto"></div>
        </div>

        <!-- 2. Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± (Ø§Ù„Ø¬Ø¯ÙŠØ¯) -->
        <div class="bg-white p-6 rounded-xl shadow-md border-t-4 border-blue-600">
            <h2 class="section-title text-blue-800">2. Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø¨ÙŠØ¹ (Store) ğŸ›’</h2>
            <div class="space-y-3 mb-4">
                <div class="grid grid-cols-2 gap-2">
                    <input id="prod-title" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" class="p-2 border rounded">
                    <input id="prod-price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø± ($)" class="p-2 border rounded">
                </div>
                <input id="prod-img" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Preview)" class="w-full p-2 border rounded">
                <input id="prod-url" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙØ¹ (PayPal)" class="w-full p-2 border rounded">
                <button onclick="addStoreProduct()" class="w-full bg-blue-600 text-white p-2 rounded font-bold hover:bg-blue-700">Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø±</button>
            </div>
            <div id="store-container" class="max-h-[250px] overflow-y-auto"></div>
        </div>

    </div>

    <!-- 3. Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ -->
    <div class="bg-white p-6 rounded-xl shadow-md mt-6 border-t-4 border-green-500">
        <h2 class="section-title text-green-700">3. Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ (Portfolio) ğŸ¨</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <input id="port-title" placeholder="Ø§Ø³Ù… Ø§Ù„ØªØµÙ…ÙŠÙ…" class="p-2 border rounded">
            <select id="port-platform" class="p-2 border rounded bg-gray-50">
                <option value="redbubble">Redbubble</option>
                <option value="amazon">Amazon</option>
                <option value="behance">Behance</option>
                <option value="other">Ø£Ø®Ø±Ù‰</option>
            </select>
            <input id="port-url" placeholder="Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ" class="p-2 border rounded">
            <input id="port-img" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©" class="p-2 border rounded">
        </div>
        <button onclick="addPortfolio()" class="w-full bg-green-600 hover:bg-green-700 text-white p-3 rounded font-bold">Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ù…Ø¹Ø±Ø¶</button>
        <div id="portfolio-container" class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-6"></div>
    </div>

  </div>
</body>
</html>